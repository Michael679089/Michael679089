---
import { ContentSchemaContainsSlugError } from "node_modules/astro/dist/core/errors/errors-data";
import Pagination from "../components/control/Pagination.astro";
import PostPage from "../components/PostPage.astro";
import { PAGE_SIZE } from "../constants/constants";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { getSortedPosts } from "../utils/content-utils";

export const getStaticPaths = async ({
	paginate,
}: {
	paginate: (data: Posts_Props[], options: options) => any;
}) => {
	const pageSize = PAGE_SIZE;
	const allBlogPosts = await getSortedPosts();

	return paginate(allBlogPosts, { pageSize });
};
// https://github.com/withastro/astro/issues/6507#issuecomment-1489916992

console.log(
	"What's inside getStaticPaths?",
	await getStaticPaths({ paginate: (data, options) => ({ data, options }) }),
);

interface options {
	pageSize: number;
}

export interface Posts_Props {
	id: string;
	/* @jsxImportSource astro */
	map(
		arg0: (post: Posts_Props) => {
			title: string;
			pubDate: Date;
			description: string;
			link: string;
			content: string;
		},
	):
		| import("@astrojs/rss").RSSFeedItem[]
		| Record<string, (...args: unknown[]) => Promise<any>>;
	/* @jsxImportSource astro */
	map(
		arg0: (post: Posts_Props) => {
			title: string;
			pubDate: Date;
			description: string;
			link: string;
			content: string;
		},
	):
		| import("@astrojs/rss").RSSFeedItem[]
		| Record<string, (...args: unknown[]) => Promise<any>>;
	/* @jsxImportSource astro */
	map(
		arg0: (post: Posts_Props) => {
			title: string;
			pubDate: Date;
			description: string;
			link: string;
			content: string;
		},
	):
		| import("@astrojs/rss").RSSFeedItem[]
		| Record<string, (...args: unknown[]) => Promise<any>>;
	/* @jsxImportSource astro */
	map(
		arg0: (post: Posts_Props) => {
			title: string;
			pubDate: Date;
			description: string;
			link: string;
			content: string;
		},
	):
		| import("@astrojs/rss").RSSFeedItem[]
		| Record<string, (...args: unknown[]) => Promise<any>>;
	data: {
		title: string;
		published: Date;
		draft: boolean;
		decsription: string;
		tags: string[];
		category: string | null;
		lang: string;
		prevTitle: string | null;
		prevSlug: string | null;
		nextTitle: string | null;
		nextSlug: string | null;
	};
	body: string;
	filePath: string;
	digest: string;
	rendered: {
		html: string;
		metadata: any;
	};
	collection: string;
	slug: string;
	render: any;
}

export interface PageProp {
	page: {
		data: Posts_Props[];
		start: number;
		end: number;
		size: number;
		total: number;
		currentPage: 1;
		lastPage: 1;
		url: {
			current: string;
			next: string | undefined;
			prev: string | undefined;
			first: string | undefined;
			last: string | undefined;
		};
	};
}

const { page } = Astro.props as PageProp;

let len: number;
try {
	len = page.data.length;
} catch (error: unknown) {
	if (error instanceof TypeError) {
		console.error("Error accessing page data:", error);
	} else {
		console.error("Unexpected error:", error);
	}
	len = 0;
}
---

<MainGridLayout>
    <PostPage page={page}></PostPage>
    <Pagination
        class="mx-auto onload-animation"
        page={{
            ...page,
            currentPage: page.currentPage ?? 1,
            lastPage: page.lastPage ?? 1,
            url: page.url ?? ''
        }}
        style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}
    ></Pagination>
</MainGridLayout>
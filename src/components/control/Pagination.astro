---
import { Icon } from "astro-icon/components";
import { url } from "../../utils/url-utils";

interface PaginationPage {
	currentPage: number;
	lastPage: number;
	url: {
		current: string;
		prev?: string;
		next?: string;
		first?: string;
		last?: string;
	};
}

interface Props {
	page: PaginationPage;
	class?: string;
	style?: string;
}

import { type PageProp } from "../../pages/[...page].astro";

const { page } = Astro.props as PageProp;

const HIDDEN = -1;

const className = Astro.props.class;

const ADJ_DIST = 2;
const VISIBLE = ADJ_DIST * 2 + 1;

// for test
// Simplified pagination logic
let pages: number[] = [];
const showAdj = 2; // pages to show adjacent to current
const { currentPage, lastPage } = page;

// Always show first page
if (currentPage > 1) pages.push(1);
// Ellipsis if gap between first and current-2
if (currentPage - showAdj > 2) pages.push(HIDDEN);

// Show adjacent pages before current
for (let i = Math.max(2, currentPage - showAdj); i < currentPage; i++) {
	pages.push(i);
}

// Show current page
pages.push(currentPage);

// Show adjacent pages after current
for (
	let i = currentPage + 1;
	i <= Math.min(lastPage - 1, currentPage + showAdj);
	i++
) {
	pages.push(i);
}

// Ellipsis if gap between current+2 and last
if (currentPage + showAdj < lastPage - 1) pages.push(HIDDEN);

// Always show last page if not current
if (currentPage < lastPage) pages.push(lastPage);

const getPageUrl = (p: number) => {
	if (p === 1) return "/";
	return `/${p}/`;
};
---

<div class:list={[className, "flex flex-row gap-3 justify-center"]}>
    <a href={page.url.prev || ""} aria-label={page.url.prev ? "Previous Page" : null}
       class:list={["btn-card overflow-hidden rounded-lg text-[var(--primary)] w-11 h-11",
           {"disabled": page.url.prev == undefined}
       ]}
    >
        <Icon name="material-symbols:chevron-left-rounded" class="text-[1.75rem]"></Icon>
    </a>
    <div class="bg-[var(--card-bg)] flex flex-row rounded-lg items-center text-neutral-700 dark:text-neutral-300 font-bold">
        {pages.map((p) => {
            if (p == HIDDEN)
                return <Icon name="material-symbols:more-horiz" class="mx-1"/>;
            if (p == page.currentPage)
                return <div class="h-11 w-11 rounded-lg bg-[var(--primary)] flex items-center justify-center
                    font-bold text-white dark:text-black/70"
                >
                    {p}
                </div>
            return <a href={url(getPageUrl(p))} aria-label={`Page ${p}`}
                class="btn-card w-11 h-11 rounded-lg overflow-hidden active:scale-[0.85]"
            >{p}</a>
        })}
    </div>
    <a href={page.url.next || ""} aria-label={page.url.next ? "Next Page" : null}
       class:list={["btn-card overflow-hidden rounded-lg text-[var(--primary)] w-11 h-11",
           {"disabled": page.url.next == undefined}
       ]}
    >
        <Icon name="material-symbols:chevron-right-rounded" class="text-[1.75rem]"></Icon>
    </a>
</div>